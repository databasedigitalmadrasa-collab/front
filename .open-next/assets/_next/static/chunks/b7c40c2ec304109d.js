(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,149943,e=>{"use strict";var s=e.i(794313),t=e.i(801244),r=e.i(368340),l=e.i(167881),i=e.i(23750),a=e.i(10708),o=e.i(184762),n=e.i(319036),c=e.i(352910),d=e.i(390864),u=e.i(417508),h=e.i(596927),m=e.i(229439),x=e.i(237180),p=e.i(411741),g=e.i(510965);let f=(0,g.default)("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);var j=e.i(884357),y=e.i(462412),v=e.i(290768),b=e.i(283272);let N=(0,g.default)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),w=(0,g.default)("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);var S=e.i(927944),k=e.i(301682),C=e.i(813637);let _=(0,g.default)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var E=e.i(120682),L=e.i(630374),$=e.i(778662),F=e.i(368135),T=e.i(670090),I=e.i(21221),B=e.i(705576);let P=function({isOpen:e,onClose:t,onSelect:a,filterType:o="all",bucket:n="media"}){let[c,d]=(0,r.useState)(""),[h,m]=(0,r.useState)([]),[x,p]=(0,r.useState)([]),[g,f]=(0,r.useState)(!0),[b,N]=(0,r.useState)(""),[w,S]=(0,r.useState)(null),[k,C]=(0,r.useState)(""),{toast:_}=(0,E.useToast)(),P=async()=>{f(!0);try{let e=c?`?prefix=${encodeURIComponent(c)}`:"",s=await fetch(`https://srv.digitalmadrasa.co.in/api/v1/${n}/objects/list${e}`);if(!s.ok)throw Error("Failed to fetch media items");let t=await s.json();if(t.success){N(t.publicUrl);let e=new Set,s=[];t.items.forEach(t=>{let r=t.key.substring(c.length);if(r.endsWith("/")){let s=r.slice(0,-1);s&&!s.includes("/")&&e.add(s)}else if(r.includes("/")){let s=r.split("/")[0];s&&e.add(s)}else s.push(t)}),m(Array.from(e));let r=s;"video"===o?r=s.filter(e=>M(e.key)):"image"===o&&(r=s.filter(e=>R(e.key))),p(r)}}catch(e){console.error("[v0] Error fetching media:",e),_({title:"Error",description:"Failed to load media items",variant:"destructive"})}finally{f(!1)}};(0,r.useEffect)(()=>{e&&P()},[e,c,n]);let M=e=>["mp4","avi","mov","webm","mkv"].includes(e.split(".").pop()?.toLowerCase()||""),R=e=>["jpg","jpeg","png","gif","webp","svg"].includes(e.split(".").pop()?.toLowerCase()||""),D=e=>{-1===e?d(""):d(c.split("/").filter(Boolean).slice(0,e+1).join("/")+"/"),S(null)},U=c.split("/").filter(Boolean),z=x.filter(e=>(e.key.split("/").pop()||"").toLowerCase().includes(k.toLowerCase()));return(0,s.jsx)(L.Dialog,{open:e,onOpenChange:t,children:(0,s.jsxs)(L.DialogContent,{className:"max-w-4xl max-h-[80vh] overflow-hidden flex flex-col",children:[(0,s.jsxs)(L.DialogHeader,{children:[(0,s.jsx)(L.DialogTitle,{children:"Select Media File"}),(0,s.jsx)(L.DialogDescription,{children:"Browse and select a file from your media library"})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-hidden flex flex-col gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm overflow-x-auto pb-2 border-b",children:[(0,s.jsxs)("button",{onClick:()=>D(-1),className:"flex items-center gap-1 text-blue-600 hover:text-blue-700 hover:underline whitespace-nowrap",children:[(0,s.jsx)(F.Home,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Root"})]}),U.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(u.ChevronRight,{className:"w-4 h-4 text-gray-400"}),(0,s.jsx)("button",{onClick:()=>D(t),className:"text-blue-600 hover:text-blue-700 hover:underline whitespace-nowrap",children:e})]},t))]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(B.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,s.jsx)(i.Input,{value:k,onChange:e=>C(e.target.value),placeholder:"Search files...",className:"pl-10"})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto border rounded-lg bg-gray-50",children:g?(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)(v.Loader2,{className:"w-8 h-8 animate-spin text-blue-600"})}):(0,s.jsxs)("div",{className:"p-4 space-y-2",children:[h.map(e=>(0,s.jsxs)("button",{onClick:()=>{d(c+e+"/"),S(null)},className:"w-full flex items-center gap-3 p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition-colors",children:[(0,s.jsx)($.Folder,{className:"w-5 h-5 text-yellow-500 flex-shrink-0"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e})]},e)),z.map(e=>{var t;let r,l=e.key.split("/").pop()||e.key,i=w?.key===e.key;return(0,s.jsxs)("button",{onClick:()=>S(e),className:`w-full flex items-center gap-3 p-3 rounded-lg border transition-colors ${i?"bg-blue-50 border-blue-500":"bg-white border-gray-200 hover:border-blue-400 hover:bg-blue-50"}`,children:[(t=l,["jpg","jpeg","png","gif","webp","svg"].includes((r=t.split(".").pop()?.toLowerCase())||"")?(0,s.jsx)(T.ImageIcon,{className:"w-5 h-5 text-blue-500"}):["mp4","avi","mov","webm","mkv"].includes(r||"")?(0,s.jsx)(j.Video,{className:"w-5 h-5 text-purple-500"}):["pdf","doc","docx","txt"].includes(r||"")?(0,s.jsx)(y.FileText,{className:"w-5 h-5 text-red-500"}):["zip","rar","7z","tar"].includes(r||"")?(0,s.jsx)(I.FileArchive,{className:"w-5 h-5 text-orange-500"}):(0,s.jsx)(T.ImageIcon,{className:"w-5 h-5 text-gray-500"})),(0,s.jsxs)("div",{className:"flex-1 text-left min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:l}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:(e=>{if(0===e)return"0 B";let s=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,s)).toFixed(2)} ${["B","KB","MB","GB"][s]}`})(e.size)})]}),i&&(0,s.jsx)("div",{className:"w-5 h-5 rounded-full bg-blue-600 flex items-center justify-center flex-shrink-0",children:(0,s.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]},e.key)}),0===h.length&&0===z.length&&(0,s.jsx)("div",{className:"text-center py-12 text-gray-500",children:(0,s.jsxs)("p",{children:["No ","all"!==o?o:""," files found"]})})]})})]}),(0,s.jsxs)(L.DialogFooter,{children:[(0,s.jsx)(l.Button,{variant:"outline",onClick:t,children:"Cancel"}),(0,s.jsx)(l.Button,{onClick:()=>{w&&(a(w.accessUrl,w.key),t(),S(null),d(""))},disabled:!w,className:"bg-blue-600 hover:bg-blue-700",children:"Select File"})]})]})})};var M=e.i(538036),R=e.i(62870);let D="https://srv.digitalmadrasa.co.in/api/v1";function U(){let e=(0,t.useParams)(),[g,$]=(0,r.useState)(null),[F,T]=(0,r.useState)([]),[I,B]=(0,r.useState)(!0),[U,z]=(0,r.useState)(null),[A,O]=(0,r.useState)([]),[V,J]=(0,r.useState)({}),[H,K]=(0,r.useState)(!1),[q,G]=(0,r.useState)(""),[W,Y]=(0,r.useState)(!1),[X,Z]=(0,r.useState)(null),[Q,ee]=(0,r.useState)(!0),[es,et]=(0,r.useState)(!1),[er,el]=(0,r.useState)(!1),[ei,ea]=(0,r.useState)(null),[eo,en]=(0,r.useState)(!1),ec=(0,r.useRef)(null),{toast:ed}=(0,E.useToast)(),eu=(0,t.useRouter)(),[eh,em]=(0,r.useState)([]),[ex,ep]=(0,r.useState)(!1),[eg,ef]=(0,r.useState)(!1),[ej,ey]=(0,r.useState)(null),[ev,eb]=(0,r.useState)({title:"",resource_type:"pdf",url:"",file_url:""}),[eN,ew]=(0,r.useState)(!1),[eS,ek]=(0,r.useState)(0),eC=(0,r.useRef)(null);(0,r.useEffect)(()=>{e_()},[e.courseId]);let e_=async()=>{ee(!0);try{let s=await fetch(`${D}/course-modules?course_id=${e.courseId}`);if(!s.ok)throw Error("Failed to fetch modules");let t=await s.json();console.log("Modules API response:",t);let r=(t.items||t.data||[]).sort((e,s)=>e.position-s.position),l=await fetch(`${D}/lessons?course_id=${e.courseId}`);if(!l.ok)throw Error("Failed to fetch lessons");let i=await l.json();console.log("Lessons API response:",i);let a=(i.items||i.data||[]).sort((e,s)=>e.position-s.position),o=r.map(e=>{let s=a.filter(s=>Number(s.module_id)===Number(e.id));return console.log(`Module ${e.id} (${e.title}) has ${s.length} lessons`),{...e,id:String(e.id),lessons:s.map(e=>({...e,id:String(e.id),module_id:String(e.module_id)}))}});if(O(o),T(o.map(e=>String(e.id))),o.length>0&&o[0].lessons.length>0){let e=o[0].lessons[0];if($(String(e.id)),J(e),e.r2_key){let s=e.duration_seconds||0,t=`/api/video?key=${encodeURIComponent(e.r2_key)}&duration=${s}`;Z(t)}}let n=JSON.parse(localStorage.getItem("courses")||"[]").find(s=>String(s.id)===String(e.courseId));n&&z(n)}catch(e){console.error("Error loading course data:",e),ed({title:"Error",description:"Failed to load course data",variant:"destructive"})}finally{ee(!1)}},eE=async()=>{try{let s={course_id:e.courseId,title:`Module ${A.length+1}`,position:A.length,description:""},t=await fetch(`${D}/course-modules`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw Error("Failed to create module");let r=await t.json();console.log("Create module response:",r);let l={...r.item||r.data,id:String(r.item?.id||r.data?.id),lessons:[]};O([...A,l]),T([...F,String(l.id)]),ea(String(l.id)),ed({title:"Success",description:"Module created successfully"})}catch(e){console.error("Error creating module:",e),ed({title:"Error",description:"Failed to create module",variant:"destructive"})}},eL=async(e,s)=>{try{if(!(await fetch(`${D}/course-modules/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:s})})).ok)throw Error("Failed to update module");O(A.map(t=>String(t.id)===String(e)?{...t,title:s}:t)),ea(null),ed({title:"Success",description:"Module updated successfully"})}catch(e){console.error("Error updating module:",e),ed({title:"Error",description:"Failed to update module",variant:"destructive"})}},e$=async(e,s)=>{let t=A.findIndex(s=>String(s.id)===String(e));if(-1===t)return;let r="up"===s?t-1:t+1;if(!(r<0)&&!(r>=A.length)){en(!0);try{let e=[...A],s=e[t],l=e[r],[i,a]=await Promise.all([fetch(`${D}/course-modules/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({position:r})}),fetch(`${D}/course-modules/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({position:t})})]);if(!i.ok||!a.ok)throw Error("Failed to update module positions");e[t]={...l,position:t},e[r]={...s,position:r},O(e),ed({title:"Success",description:"Module position updated"})}catch(e){console.error("Error updating module position:",e),ed({title:"Error",description:"Failed to update module position",variant:"destructive"})}finally{en(!1)}}},eF=async e=>{if(confirm("Are you sure you want to delete this module and all its lessons?"))try{if(!(await fetch(`${D}/course-modules/${e}`,{method:"DELETE"})).ok)throw Error("Failed to delete module");if(O(A.filter(s=>String(s.id)!==String(e))),g){let s=A.find(e=>e.lessons.some(e=>String(e.id)===String(g)));String(s?.id)===String(e)&&($(null),J({}))}ed({title:"Success",description:"Module deleted successfully"})}catch(e){console.error("Error deleting module:",e),ed({title:"Error",description:"Failed to delete module",variant:"destructive"})}},eT=async s=>{try{let t=A.find(e=>String(e.id)===String(s));if(!t)return void console.error("Module not found:",s);console.log("Adding lesson to module:",s,t);let r={module_id:Number(s),course_id:Number(e.courseId),title:`Lesson ${t.lessons.length+1}`,position:t.lessons.length,kind:"video",video_provider:"cloudflare",drm_protected:!1,locked:!1,completed:!1};console.log("Creating lesson with data:",r);let l=await fetch(`${D}/lessons`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!l.ok){let e=await l.text();throw console.error("Lesson creation failed:",e),Error("Failed to create lesson")}let i=await l.json();console.log("Create lesson response:",i);let a={...i.item||i.data,id:String(i.item?.id||i.data?.id),module_id:String(s)};O(A.map(e=>String(e.id)===String(s)?{...e,lessons:[...e.lessons,a]}:e)),$(String(a.id)),J(a),ed({title:"Success",description:"Lesson created successfully"})}catch(e){console.error("Error creating lesson:",e),ed({title:"Error",description:"Failed to create lesson",variant:"destructive"})}},eI=async()=>{if(!V.title?.trim())return void ed({title:"Validation Error",description:"Please enter a lesson title",variant:"destructive"});if(g){et(!0);try{let e={title:V.title,description:V.description||"",video_url:V.video_url||"",r2_key:V.r2_key||"",locked:V.locked||!1,duration_seconds:V.duration_seconds||0},s=await fetch(`${D}/lessons/${g}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw Error("Failed to update lesson");let t=await s.json(),r=t.item||t.data;O(A.map(e=>({...e,lessons:e.lessons.map(e=>String(e.id)===String(g)?r:e)}))),el(!1),ed({title:"Success",description:"Lesson saved successfully"})}catch(e){console.error("Error saving lesson:",e),ed({title:"Error",description:"Failed to save lesson",variant:"destructive"})}finally{et(!1)}}},eB=async e=>{if(er&&!window.confirm("You have unsaved changes. Are you sure you want to switch lessons?"))return;let s=A.flatMap(e=>e.lessons).find(s=>String(s.id)===String(e));if(s){if($(String(s.id)),J(s),el(!1),s.r2_key){let e=s.duration_seconds||0;Z(`/api/video?key=${encodeURIComponent(s.r2_key)}&duration=${e}`)}else Z(null);await eD(e)}},eP=async e=>{if(confirm("Are you sure you want to delete this lesson?"))try{if(!(await fetch(`${D}/lessons/${e}`,{method:"DELETE"})).ok)throw Error("Failed to delete lesson");O(A.map(s=>({...s,lessons:s.lessons.filter(s=>String(s.id)!==String(e))}))),String(g)===String(e)&&($(null),J({}),Z(null)),ed({title:"Success",description:"Lesson deleted successfully"})}catch(e){console.error("Error deleting lesson:",e),ed({title:"Error",description:"Failed to delete lesson",variant:"destructive"})}},eM=e=>{let s=String(e);T(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s])};A.find(e=>e.lessons.some(e=>String(e.id)===String(g)));let eR=(e,s)=>`/api/video?key=${encodeURIComponent(e)}&duration=${s||0}`;(0,r.useEffect)(()=>{X&&ec.current&&(ec.current.src=X)},[X]),(0,r.useEffect)(()=>{V.r2_key?Z(eR(V.r2_key,V.duration_seconds)):Z(null)},[V.r2_key,V.duration_seconds]);let eD=async e=>{ep(!0);try{let s=(0,M.getAdminToken)(),t=await fetch(`${D}/lesson-resources?lesson_id=${e}`,{headers:{Authorization:`Bearer ${s}`}}),r=await t.json();console.log("Lesson resources response:",r),r.success&&r.items?em(r.items.map(e=>({...e,id:String(e.id),lesson_id:String(e.lesson_id)}))):em([])}catch(e){console.error("Error fetching lesson resources:",e),em([])}finally{ep(!1)}},eU=async e=>{ew(!0),ek(0);try{let s=`resource-${Date.now()}-${e.name.replace(/\s+/g,"-")}`,t=`lesson-resources/${s}`,r=e.type||"application/octet-stream",l=new XMLHttpRequest;l.upload.onprogress=e=>{if(e.lengthComputable){let s=Math.round(e.loaded/e.total*100);ek(s)}};let i=new Promise(s=>{l.onload=()=>{l.status>=200&&l.status<300?s(`https://cdn.digitalmadrasa.co.in/${t}`):s(null)},l.onerror=()=>s(null),l.onabort=()=>s(null);let i=`${D}/static/objects?path=${encodeURIComponent(t)}&contentType=${encodeURIComponent(r)}`;l.open("POST",i),l.send(e)});return await i}catch(e){return console.error("Error uploading resource file:",e),null}finally{ew(!1),ek(0)}},ez=async()=>{if(!g||!ev.title.trim())return void ed({title:"Validation Error",description:"Please enter a resource title",variant:"destructive"});try{let e={lesson_id:Number(g),title:ev.title,resource_type:ev.resource_type};ev.url&&(e.url=ev.url),ev.file_url&&(e.file_url=ev.file_url);let s=await fetch(`${D}/lesson-resources`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await s.json();if(t.success&&t.data){let e={...t.data,id:String(t.data.id),lesson_id:String(t.data.lesson_id)};em([...eh,e]),ef(!1),eV(),ed({title:"Success",description:"Resource added successfully"})}else throw Error(t.message||"Failed to create resource")}catch(e){console.error("Error creating resource:",e),ed({title:"Error",description:"Failed to add resource",variant:"destructive"})}},eA=async()=>{if(!ej||!ev.title.trim())return void ed({title:"Validation Error",description:"Please enter a resource title",variant:"destructive"});try{let e={title:ev.title,resource_type:ev.resource_type};ev.url&&(e.url=ev.url),ev.file_url&&(e.file_url=ev.file_url);let s=await fetch(`${D}/lesson-resources/${ej.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await s.json();if(t.success)em(eh.map(e=>e.id===ej.id?{...e,...ev}:e)),ey(null),eV(),ed({title:"Success",description:"Resource updated successfully"});else throw Error(t.message||"Failed to update resource")}catch(e){console.error("Error updating resource:",e),ed({title:"Error",description:"Failed to update resource",variant:"destructive"})}},eO=async e=>{if(window.confirm("Are you sure you want to delete this resource?"))try{if((await fetch(`${D}/lesson-resources/${e}`,{method:"DELETE"})).ok)em(eh.filter(s=>s.id!==e)),ed({title:"Success",description:"Resource deleted successfully"});else throw Error("Failed to delete resource")}catch(e){console.error("Error deleting resource:",e),ed({title:"Error",description:"Failed to delete resource",variant:"destructive"})}},eV=()=>{eb({title:"",resource_type:"pdf",url:"",file_url:""})};return Q?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,s.jsxs)("div",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${I?"w-80":"w-0 overflow-hidden"}`,children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,s.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:()=>eu.push("/admin/courses"),className:"text-gray-600",children:[(0,s.jsx)(c.ChevronLeft,{className:"w-4 h-4 mr-1"}),"Back"]})}),(0,s.jsx)("h2",{className:"font-semibold text-gray-900 truncate",children:U?.title||"Course Editor"})]}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:"Modules"}),(0,s.jsxs)(l.Button,{onClick:eE,size:"sm",variant:"outline",className:"h-8 bg-transparent",children:[(0,s.jsx)(m.Plus,{className:"w-4 h-4 mr-1"}),"Add Module"]})]}),0===A.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,s.jsx)(y.FileText,{className:"w-6 h-6 text-gray-400"})}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-3",children:"No modules yet"}),(0,s.jsxs)(l.Button,{onClick:eE,size:"sm",children:[(0,s.jsx)(m.Plus,{className:"w-4 h-4 mr-1"}),"Create First Module"]})]}):(0,s.jsx)("div",{className:"space-y-2",children:A.map((e,t)=>(0,s.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-gray-50 border-b border-gray-200",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,s.jsx)(l.Button,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>e$(String(e.id),"up"),disabled:0===t||eo,children:(0,s.jsx)(h.ChevronUp,{className:"w-3 h-3"})}),(0,s.jsx)(l.Button,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>e$(String(e.id),"down"),disabled:t===A.length-1||eo,children:(0,s.jsx)(d.ChevronDown,{className:"w-3 h-3"})})]}),(0,s.jsx)(l.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0",onClick:()=>eM(String(e.id)),children:F.includes(String(e.id))?(0,s.jsx)(d.ChevronDown,{className:"w-4 h-4"}):(0,s.jsx)(u.ChevronRight,{className:"w-4 h-4"})}),ei===String(e.id)?(0,s.jsx)("div",{className:"flex-1 flex items-center gap-1",children:(0,s.jsx)(i.Input,{defaultValue:e.title,className:"h-7 text-sm",autoFocus:!0,onKeyDown:s=>{"Enter"===s.key?eL(String(e.id),s.currentTarget.value):"Escape"===s.key&&ea(null)},onBlur:s=>eL(String(e.id),s.target.value)})}):(0,s.jsx)("span",{className:"text-sm font-medium flex-1 truncate cursor-pointer",onClick:()=>eM(String(e.id)),children:e.title}),(0,s.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,s.jsx)("span",{className:"text-xs text-gray-500 bg-gray-200 px-1.5 py-0.5 rounded",children:e.lessons.length}),(0,s.jsx)(l.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>ea(String(e.id)),children:(0,s.jsx)(_,{className:"w-3.5 h-3.5"})}),(0,s.jsx)(l.Button,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>eF(String(e.id)),children:(0,s.jsx)(p.Trash2,{className:"w-3.5 h-3.5 text-red-600"})})]})]}),F.includes(String(e.id))&&(0,s.jsx)("div",{className:"p-2 space-y-1",children:0===e.lessons.length?(0,s.jsxs)("div",{className:"text-center py-4",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-3",children:"No lessons yet"}),(0,s.jsxs)(l.Button,{onClick:()=>eT(String(e.id)),size:"sm",variant:"outline",className:"text-xs h-8",children:[(0,s.jsx)(m.Plus,{className:"w-3 h-3 mr-1"}),"Add Lesson"]})]}):(0,s.jsxs)(s.Fragment,{children:[e.lessons.map(e=>(0,s.jsxs)("div",{onClick:()=>eB(String(e.id)),className:`flex items-center gap-2 p-2 rounded cursor-pointer transition-colors group ${String(g)===String(e.id)?"bg-blue-50 border border-blue-200":"hover:bg-gray-50 border border-transparent"}`,children:[(0,s.jsx)(j.Video,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),(0,s.jsx)("span",{className:"text-xs flex-1 truncate",children:e.title||"Untitled Lesson"}),(0,s.jsx)(l.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0 opacity-0 group-hover:opacity-100",onClick:s=>{s.stopPropagation(),eP(String(e.id))},children:(0,s.jsx)(p.Trash2,{className:"w-3 h-3 text-red-600"})})]},e.id)),(0,s.jsxs)(l.Button,{onClick:()=>eT(String(e.id)),size:"sm",variant:"outline",className:"w-full text-xs h-8 mt-2",children:[(0,s.jsx)(m.Plus,{className:"w-3 h-3 mr-1"}),"Add Lesson"]})]})})]},e.id))})]})]}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,s.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 py-3 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(l.Button,{variant:"ghost",size:"icon",onClick:()=>B(!I),className:"text-gray-600",children:(0,s.jsx)(f,{className:"w-5 h-5"})}),(0,s.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:V?.title||"Select a lesson to edit"}),er&&(0,s.jsx)("span",{className:"text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded",children:"Unsaved"})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)(l.Button,{size:"sm",onClick:eI,disabled:es||!g,children:[(0,s.jsx)(x.Save,{className:"w-4 h-4 mr-1"}),es?"Saving...":"Save Lesson"]})})]}),(0,s.jsx)("div",{className:"flex-1 overflow-auto p-6",children:g?(0,s.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,s.jsx)("div",{className:"bg-gray-900 rounded-lg aspect-video flex items-center justify-center overflow-hidden",children:X?(0,s.jsx)("video",{ref:ec,controls:!0,controlsList:"nodownload noplaybackrate",disablePictureInPicture:!0,className:"w-full h-full object-contain",onLoadedMetadata:()=>{if(ec.current){let e=Math.floor(ec.current.duration),s=Math.floor(e/60),t=e%60,r=`${String(s).padStart(2,"0")}:${String(t).padStart(2,"0")}`;J({...V,duration:r,duration_seconds:e}),el(!0)}},onContextMenu:e=>e.preventDefault(),children:"Your browser does not support the video tag."},X):(0,s.jsxs)("div",{className:"text-center text-gray-400",children:[(0,s.jsx)(j.Video,{className:"w-16 h-16 mx-auto mb-2 opacity-50"}),(0,s.jsx)("p",{children:"No video selected"})]})}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(a.Label,{children:"Lesson Title"}),(0,s.jsx)(i.Input,{value:V?.title||"",onChange:e=>{J({...V,title:e.target.value}),el(!0)},placeholder:"Enter lesson title"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(a.Label,{children:"Lesson Type"}),(0,s.jsx)(i.Input,{value:"Video",disabled:!0,className:"bg-gray-50"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(a.Label,{children:"Description"}),(0,s.jsx)(o.Textarea,{value:V?.description||"",onChange:e=>{J({...V,description:e.target.value}),el(!0)},placeholder:"Enter lesson description",rows:3})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(a.Label,{children:"Video Provider"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(i.Input,{value:"Cloudflare",disabled:!0,className:"bg-gray-50 flex-1"}),(0,s.jsxs)(l.Button,{variant:"outline",onClick:()=>Y(!0),children:[(0,s.jsx)(b.Upload,{className:"w-4 h-4 mr-1"}),"Select Video"]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(a.Label,{children:"Duration"}),(0,s.jsx)(i.Input,{value:V?.duration||"",disabled:!0,className:"bg-gray-50",placeholder:"Auto-detected from video"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(a.Label,{children:"Video URL"}),(0,s.jsx)(i.Input,{value:V?.video_url||"",disabled:!0,className:"bg-gray-50",placeholder:"Select a video to populate"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(a.Label,{children:"R2 Key"}),(0,s.jsx)(i.Input,{value:V?.r2_key||"",disabled:!0,className:"bg-gray-50",placeholder:"Auto-populated from selection"})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[(0,s.jsx)("div",{className:"flex items-center gap-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.Switch,{checked:V?.locked||!1,onCheckedChange:e=>{J({...V,locked:e}),el(!0)}}),(0,s.jsx)(a.Label,{children:"Locked"})]})}),(0,s.jsxs)(l.Button,{variant:"destructive",size:"sm",onClick:()=>g&&eP(g),children:[(0,s.jsx)(p.Trash2,{className:"w-4 h-4 mr-1"}),"Delete Lesson"]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,s.jsx)(y.FileText,{className:"w-5 h-5"}),"Lesson Resources"]}),(0,s.jsxs)(l.Button,{size:"sm",onClick:()=>{eV(),ef(!0)},children:[(0,s.jsx)(m.Plus,{className:"w-4 h-4 mr-1"}),"Add Resource"]})]}),ex?(0,s.jsxs)("div",{className:"flex items-center justify-center py-8 gap-2",children:[(0,s.jsx)(v.Loader2,{className:"w-6 h-6 animate-spin text-blue-500"}),(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Loading resources..."})]}):0===eh.length?(0,s.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,s.jsx)(y.FileText,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),(0,s.jsx)("p",{children:"No resources added yet"}),(0,s.jsx)("p",{className:"text-sm",children:"Add PDFs, links, or other materials for this lesson"})]}):(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("p",{className:"text-sm text-gray-500 mb-3",children:[eh.length," resource(s) found"]}),eh.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(e=>{switch(e){case"pdf":return(0,s.jsx)(y.FileText,{className:"w-4 h-4 text-red-500"});case"image":return(0,s.jsx)(S.FileImage,{className:"w-4 h-4 text-blue-500"});case"link":return(0,s.jsx)(k.LinkIcon,{className:"w-4 h-4 text-green-500"});default:return(0,s.jsx)(w,{className:"w-4 h-4 text-gray-500"})}})(e.resource_type),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-900",children:e.title}),(0,s.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:e.resource_type})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(e.url||e.file_url)&&(0,s.jsx)("a",{href:e.file_url||e.url,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded",children:(0,s.jsx)(C.Download,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>{ey(e),eb({title:e.title,resource_type:e.resource_type,url:e.url||"",file_url:e.file_url||""})},className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded",children:(0,s.jsx)(N,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>eO(e.id),className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded",children:(0,s.jsx)(p.Trash2,{className:"w-4 h-4"})})]})]},e.id))]})]})]}):(0,s.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)(j.Video,{className:"w-8 h-8 text-gray-400"})}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Lesson Selected"}),(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:0===A.length?"Create a module first, then add lessons to it":"Select a lesson from the sidebar to edit, or create a new one"}),0===A.length&&(0,s.jsxs)(l.Button,{onClick:eE,children:[(0,s.jsx)(m.Plus,{className:"w-4 h-4 mr-1"}),"Create First Module"]})]})})})]}),(0,s.jsx)(P,{isOpen:W,onClose:()=>Y(!1),onSelect:(e,s)=>{J({...V,video_url:e,r2_key:s}),Z(eR(s)),Y(!1)},filterType:"video"}),(0,s.jsx)(L.Dialog,{open:eg||null!==ej,onOpenChange:e=>{e||(ef(!1),ey(null),eV())},children:(0,s.jsxs)(L.DialogContent,{className:"sm:max-w-md",children:[(0,s.jsx)(L.DialogHeader,{children:(0,s.jsx)(L.DialogTitle,{children:ej?"Edit Resource":"Add Resource"})}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(a.Label,{children:"Title"}),(0,s.jsx)(i.Input,{value:ev.title,onChange:e=>eb({...ev,title:e.target.value}),placeholder:"Enter resource title"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(a.Label,{children:"Resource Type"}),(0,s.jsxs)(R.Select,{value:ev.resource_type,onValueChange:e=>eb({...ev,resource_type:e}),children:[(0,s.jsx)(R.SelectTrigger,{children:(0,s.jsx)(R.SelectValue,{placeholder:"Select type"})}),(0,s.jsxs)(R.SelectContent,{children:[(0,s.jsx)(R.SelectItem,{value:"pdf",children:"PDF"}),(0,s.jsx)(R.SelectItem,{value:"image",children:"Image"}),(0,s.jsx)(R.SelectItem,{value:"link",children:"Link"}),(0,s.jsx)(R.SelectItem,{value:"document",children:"Document"}),(0,s.jsx)(R.SelectItem,{value:"video",children:"Video"}),(0,s.jsx)(R.SelectItem,{value:"other",children:"Other"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(a.Label,{children:"External URL (optional)"}),(0,s.jsx)(i.Input,{value:ev.url,onChange:e=>eb({...ev,url:e.target.value}),placeholder:"https://example.com/resource"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(a.Label,{children:"File Upload"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(i.Input,{value:ev.file_url,onChange:e=>eb({...ev,file_url:e.target.value}),placeholder:"File URL (auto-populated on upload)",className:"flex-1",readOnly:!0}),(0,s.jsx)("input",{type:"file",ref:eC,className:"hidden",onChange:async e=>{let s=e.target.files?.[0];if(s){let e=await eU(s);e?(eb({...ev,file_url:e}),ed({title:"Success",description:"File uploaded successfully"})):ed({title:"Error",description:"Failed to upload file",variant:"destructive"})}}}),(0,s.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>eC.current?.click(),disabled:eN,children:eN?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.Loader2,{className:"w-4 h-4 mr-1 animate-spin"}),eS,"%"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.Upload,{className:"w-4 h-4 mr-1"}),"Upload"]})})]})]})]}),(0,s.jsxs)(L.DialogFooter,{children:[(0,s.jsx)(l.Button,{variant:"outline",onClick:()=>{ef(!1),ey(null),eV()},children:"Cancel"}),(0,s.jsxs)(l.Button,{onClick:ej?eA:ez,disabled:!ev.title.trim(),children:[ej?"Update":"Add"," Resource"]})]})]})})]})}e.s(["default",()=>U],149943)}]);