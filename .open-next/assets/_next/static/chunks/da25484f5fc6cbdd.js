(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,588580,e=>{"use strict";var t=e.i(794313),a=e.i(368340),l=e.i(167881),s=e.i(23750),i=e.i(10708),r=e.i(36102),n=e.i(178896),o=e.i(400866),c=e.i(929517),d=e.i(788552),h=e.i(733649),u=e.i(455726),m=e.i(422377),x=e.i(620673),g=e.i(856700),p=["PageUp","PageDown"],f=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],v={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},b="Slider",[w,j,y]=(0,g.createCollection)(b),[N,S]=(0,c.createContextScope)(b,[y]),[k,C]=N(b),A=a.forwardRef((e,l)=>{let{name:s,min:i=0,max:o=100,step:c=1,orientation:h="horizontal",disabled:u=!1,minStepsBetweenThumbs:m=0,defaultValue:x=[i],value:g,onValueChange:v=()=>{},onValueCommit:b=()=>{},inverted:j=!1,form:y,...N}=e,S=a.useRef(new Set),C=a.useRef(0),A="horizontal"===h,[P=[],R]=(0,d.useControllableState)({prop:g,defaultProp:x,onChange:e=>{let t=[...S.current];t[C.current]?.focus(),v(e)}}),L=a.useRef(P);function I(e,t,{commit:a}={commit:!1}){let l,s=(String(c).split(".")[1]||"").length,n=Math.round((Math.round((e-i)/c)*c+i)*(l=Math.pow(10,s)))/l,d=(0,r.clamp)(n,[i,o]);R((e=[])=>{let l=function(e=[],t,a){let l=[...e];return l[a]=t,l.sort((e,t)=>e-t)}(e,d,t);if(!function(e,t){if(t>0)return Math.min(...e.slice(0,-1).map((t,a)=>e[a+1]-t))>=t;return!0}(l,m*c))return e;{C.current=l.indexOf(d);let t=String(l)!==String(e);return t&&a&&b(l),t?l:e}})}return(0,t.jsx)(k,{scope:e.__scopeSlider,name:s,disabled:u,min:i,max:o,valueIndexToChangeRef:C,thumbs:S.current,values:P,orientation:h,form:y,children:(0,t.jsx)(w.Provider,{scope:e.__scopeSlider,children:(0,t.jsx)(w.Slot,{scope:e.__scopeSlider,children:(0,t.jsx)(A?T:M,{"aria-disabled":u,"data-disabled":u?"":void 0,...N,ref:l,onPointerDown:(0,n.composeEventHandlers)(N.onPointerDown,()=>{u||(L.current=P)}),min:i,max:o,inverted:j,onSlideStart:u?void 0:function(e){let t=function(e,t){if(1===e.length)return 0;let a=e.map(e=>Math.abs(e-t)),l=Math.min(...a);return a.indexOf(l)}(P,e);I(e,t)},onSlideMove:u?void 0:function(e){I(e,C.current)},onSlideEnd:u?void 0:function(){let e=L.current[C.current];P[C.current]!==e&&b(P)},onHomeKeyDown:()=>!u&&I(i,0,{commit:!0}),onEndKeyDown:()=>!u&&I(o,P.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:t})=>{if(!u){let a=p.includes(e.key)||e.shiftKey&&f.includes(e.key),l=C.current;I(P[l]+c*(a?10:1)*t,l,{commit:!0})}}})})})})});A.displayName=b;var[P,R]=N(b,{startEdge:"left",endEdge:"right",size:"width",direction:1}),T=a.forwardRef((e,l)=>{let{min:s,max:i,dir:r,inverted:n,onSlideStart:c,onSlideMove:d,onSlideEnd:u,onStepKeyDown:m,...x}=e,[g,p]=a.useState(null),f=(0,o.useComposedRefs)(l,e=>p(e)),b=a.useRef(void 0),w=(0,h.useDirection)(r),j="ltr"===w,y=j&&!n||!j&&n;function N(e){let t=b.current||g.getBoundingClientRect(),a=V([0,t.width],y?[s,i]:[i,s]);return b.current=t,a(e-t.left)}return(0,t.jsx)(P,{scope:e.__scopeSlider,startEdge:y?"left":"right",endEdge:y?"right":"left",direction:y?1:-1,size:"width",children:(0,t.jsx)(L,{dir:w,"data-orientation":"horizontal",...x,ref:f,style:{...x.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{let t=N(e.clientX);c?.(t)},onSlideMove:e=>{let t=N(e.clientX);d?.(t)},onSlideEnd:()=>{b.current=void 0,u?.()},onStepKeyDown:e=>{let t=v[y?"from-left":"from-right"].includes(e.key);m?.({event:e,direction:t?-1:1})}})})}),M=a.forwardRef((e,l)=>{let{min:s,max:i,inverted:r,onSlideStart:n,onSlideMove:c,onSlideEnd:d,onStepKeyDown:h,...u}=e,m=a.useRef(null),x=(0,o.useComposedRefs)(l,m),g=a.useRef(void 0),p=!r;function f(e){let t=g.current||m.current.getBoundingClientRect(),a=V([0,t.height],p?[i,s]:[s,i]);return g.current=t,a(e-t.top)}return(0,t.jsx)(P,{scope:e.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:(0,t.jsx)(L,{"data-orientation":"vertical",...u,ref:x,style:{...u.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{let t=f(e.clientY);n?.(t)},onSlideMove:e=>{let t=f(e.clientY);c?.(t)},onSlideEnd:()=>{g.current=void 0,d?.()},onStepKeyDown:e=>{let t=v[p?"from-bottom":"from-top"].includes(e.key);h?.({event:e,direction:t?-1:1})}})})}),L=a.forwardRef((e,a)=>{let{__scopeSlider:l,onSlideStart:s,onSlideMove:i,onSlideEnd:r,onHomeKeyDown:o,onEndKeyDown:c,onStepKeyDown:d,...h}=e,u=C(b,l);return(0,t.jsx)(x.Primitive.span,{...h,ref:a,onKeyDown:(0,n.composeEventHandlers)(e.onKeyDown,e=>{"Home"===e.key?(o(e),e.preventDefault()):"End"===e.key?(c(e),e.preventDefault()):p.concat(f).includes(e.key)&&(d(e),e.preventDefault())}),onPointerDown:(0,n.composeEventHandlers)(e.onPointerDown,e=>{let t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),u.thumbs.has(t)?t.focus():s(e)}),onPointerMove:(0,n.composeEventHandlers)(e.onPointerMove,e=>{e.target.hasPointerCapture(e.pointerId)&&i(e)}),onPointerUp:(0,n.composeEventHandlers)(e.onPointerUp,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),r(e))})})}),I="SliderTrack",E=a.forwardRef((e,a)=>{let{__scopeSlider:l,...s}=e,i=C(I,l);return(0,t.jsx)(x.Primitive.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...s,ref:a})});E.displayName=I;var z="SliderRange",D=a.forwardRef((e,l)=>{let{__scopeSlider:s,...i}=e,r=C(z,s),n=R(z,s),c=a.useRef(null),d=(0,o.useComposedRefs)(l,c),h=r.values.length,u=r.values.map(e=>H(e,r.min,r.max)),m=h>1?Math.min(...u):0,g=100-Math.max(...u);return(0,t.jsx)(x.Primitive.span,{"data-orientation":r.orientation,"data-disabled":r.disabled?"":void 0,...i,ref:d,style:{...e.style,[n.startEdge]:m+"%",[n.endEdge]:g+"%"}})});D.displayName=z;var B="SliderThumb",U=a.forwardRef((e,l)=>{let s=j(e.__scopeSlider),[i,r]=a.useState(null),n=(0,o.useComposedRefs)(l,e=>r(e)),c=a.useMemo(()=>i?s().findIndex(e=>e.ref.current===i):-1,[s,i]);return(0,t.jsx)(F,{...e,ref:n,index:c})}),F=a.forwardRef((e,l)=>{var s,i,r,c,d;let h,u,{__scopeSlider:g,index:p,name:f,...v}=e,b=C(B,g),j=R(B,g),[y,N]=a.useState(null),S=(0,o.useComposedRefs)(l,e=>N(e)),k=!y||b.form||!!y.closest("form"),A=(0,m.useSize)(y),P=b.values[p],T=void 0===P?0:H(P,b.min,b.max),M=(s=p,(i=b.values.length)>2?`Value ${s+1} of ${i}`:2===i?["Minimum","Maximum"][s]:void 0),L=A?.[j.size],I=L?(r=L,c=T,d=j.direction,u=V([0,50],[0,h=r/2]),(h-u(c)*d)*d):0;return a.useEffect(()=>{if(y)return b.thumbs.add(y),()=>{b.thumbs.delete(y)}},[y,b.thumbs]),(0,t.jsxs)("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[j.startEdge]:`calc(${T}% + ${I}px)`},children:[(0,t.jsx)(w.ItemSlot,{scope:e.__scopeSlider,children:(0,t.jsx)(x.Primitive.span,{role:"slider","aria-label":e["aria-label"]||M,"aria-valuemin":b.min,"aria-valuenow":P,"aria-valuemax":b.max,"aria-orientation":b.orientation,"data-orientation":b.orientation,"data-disabled":b.disabled?"":void 0,tabIndex:b.disabled?void 0:0,...v,ref:S,style:void 0===P?{display:"none"}:e.style,onFocus:(0,n.composeEventHandlers)(e.onFocus,()=>{b.valueIndexToChangeRef.current=p})})}),k&&(0,t.jsx)(O,{name:f??(b.name?b.name+(b.values.length>1?"[]":""):void 0),form:b.form,value:P},p)]})});U.displayName=B;var O=e=>{let{value:l,...s}=e,i=a.useRef(null),r=(0,u.usePrevious)(l);return a.useEffect(()=>{let e=i.current,t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set;if(r!==l&&t){let a=new Event("input",{bubbles:!0});t.call(e,l),e.dispatchEvent(a)}},[r,l]),(0,t.jsx)("input",{style:{display:"none"},...s,ref:i,defaultValue:l})};function H(e,t,a){return(0,r.clamp)(100/(a-t)*(e-t),[0,100])}function V(e,t){return a=>{if(e[0]===e[1]||t[0]===t[1])return t[0];let l=(t[1]-t[0])/(e[1]-e[0]);return t[0]+l*(a-e[0])}}var $=e.i(647163);function _({className:e,defaultValue:l,value:s,min:i=0,max:r=100,...n}){let o=a.useMemo(()=>Array.isArray(s)?s:Array.isArray(l)?l:[i,r],[s,l,i,r]);return(0,t.jsxs)(A,{"data-slot":"slider",defaultValue:l,value:s,min:i,max:r,className:(0,$.cn)("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",e),...n,children:[(0,t.jsx)(E,{"data-slot":"slider-track",className:"bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5",children:(0,t.jsx)(D,{"data-slot":"slider-range",className:"bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full"})}),Array.from({length:o.length},(e,a)=>(0,t.jsx)(U,{"data-slot":"slider-thumb",className:"border-primary ring-ring/50 block size-4 shrink-0 rounded-full border bg-white shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},a))]})}var Y=e.i(269035),X=e.i(62870),J=e.i(630374),G=e.i(127341),K=e.i(120682),q=e.i(801244),W=e.i(584675),Q=e.i(813637),Z=e.i(510965);let ee=(0,Z.default)("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),et=(0,Z.default)("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]),ea=(0,Z.default)("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);var el=e.i(670090),es=e.i(411741);let ei=(0,Z.default)("Bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]),er=(0,Z.default)("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]),en=(0,Z.default)("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]),eo=(0,Z.default)("AlignLeft",[["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 18H3",key:"1amg6g"}],["path",{d:"M21 6H3",key:"1jwq7v"}]]),ec=(0,Z.default)("AlignCenter",[["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 18H5",key:"18s9l3"}],["path",{d:"M21 6H3",key:"1jwq7v"}]]),ed=(0,Z.default)("AlignRight",[["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 18H7",key:"1ygte8"}],["path",{d:"M21 6H3",key:"1jwq7v"}]]);var eh=e.i(283272),eu=e.i(301682),em=e.i(570271),ex=e.i(237180),eg=e.i(662245);let ep=(0,Z.default)("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),ef=(0,Z.default)("Braces",[["path",{d:"M8 3H7a2 2 0 0 0-2 2v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5c0 1.1.9 2 2 2h1",key:"ezmyqa"}],["path",{d:"M16 21h1a2 2 0 0 0 2-2v-5c0-1.1.9-2 2-2a2 2 0 0 1-2-2V5a2 2 0 0 0-2-2h-1",key:"e1hn23"}]]);var ev=e.i(290768);let eb=(0,Z.default)("RectangleHorizontal",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}]]);var ew=e.i(944908),ej=e.i(44215),ey=e.i(538036);let eN=[{label:"16:9",value:"16:9",width:900,height:506},{label:"4:3",value:"4:3",width:900,height:675},{label:"3:2",value:"3:2",width:900,height:600},{label:"1:1",value:"1:1",width:900,height:900},{label:"A4 Landscape",value:"a4-landscape",width:900,height:636},{label:"A4 Portrait",value:"a4-portrait",width:636,height:900}],eS=eN[0],ek="https://srv.digitalmadrasa.co.in/api/v1",eC=[{name:"Arial",value:"Arial",isSystem:!0},{name:"Times New Roman",value:"Times New Roman",isSystem:!0},{name:"Georgia",value:"Georgia",isSystem:!0},{name:"Courier New",value:"Courier New",isSystem:!0},{name:"Verdana",value:"Verdana",isSystem:!0},{name:"Roboto",value:"Roboto"},{name:"Open Sans",value:"Open Sans"},{name:"Lato",value:"Lato"},{name:"Montserrat",value:"Montserrat"},{name:"Playfair Display",value:"Playfair Display"},{name:"Merriweather",value:"Merriweather"},{name:"Raleway",value:"Raleway"},{name:"PT Sans",value:"PT Sans"},{name:"Oswald",value:"Oswald"},{name:"Poppins",value:"Poppins"},{name:"Inter",value:"Inter"},{name:"Bebas Neue",value:"Bebas Neue"},{name:"Dancing Script",value:"Dancing Script"},{name:"Pacifico",value:"Pacifico"},{name:"Great Vibes",value:"Great Vibes"},{name:"Cinzel",value:"Cinzel"},{name:"Cormorant Garamond",value:"Cormorant Garamond"},{name:"Crimson Text",value:"Crimson Text"},{name:"Libre Baskerville",value:"Libre Baskerville"}],eA=[{label:"Student Name",value:"{{student_name}}"},{label:"Date of Issue",value:"{{dateofIssue}}"},{label:"Certificate ID",value:"{{certificateID}}"},{label:"Course Title",value:"{{course_title}}"},{label:"Instructor Name",value:"{{instructor_name}}"}];function eP(){let e=(0,q.useParams)(),r=(0,q.useSearchParams)(),n=(0,q.useRouter)(),{toast:o}=(0,K.useToast)(),c=(0,a.useRef)(null),d=(0,a.useRef)(null),[h,u]=(0,a.useState)(null),[m,x]=(0,a.useState)([]),[g,p]=(0,a.useState)(-1),[f,v]=(0,a.useState)(!1),[b,w]=(0,a.useState)(!1),[j,y]=(0,a.useState)("upload"),[N,S]=(0,a.useState)(""),k=(0,a.useRef)(null),[C,A]=(0,a.useState)(!1),[P,R]=(0,a.useState)(0),[T,M]=(0,a.useState)(!1),[L,I]=(0,a.useState)(!1),[E,z]=(0,a.useState)(new Set),[D,B]=(0,a.useState)(!1),[U,F]=(0,a.useState)(null),[O,H]=(0,a.useState)(r.get("name")||"Certificate Template"),[V,$]=(0,a.useState)(!1),[Z,eP]=(0,a.useState)(!1),[eR,eT]=(0,a.useState)(eS),[eM,eL]=(0,a.useState)({width:eS.width,height:eS.height}),[eI,eE]=(0,a.useState)([]);(0,a.useEffect)(()=>{if(!c.current||f)return;console.log("Initializing Fabric.js canvas");let t=new ew.Canvas(c.current,{width:eS.width,height:eS.height,backgroundColor:"#ffffff"});if(d.current=t,e.id&&"new"!==e.id)console.log("Editing existing template, waiting for template data to load");else{let e=new URLSearchParams(window.location.search),a=e.get("bg"),l=e.get("name"),s=a||"/certificate-bg.png";l&&(console.log("Template name from URL:",l),H(l)),console.log("Initializing new template with background:",s),ew.FabricImage.fromURL(s,{crossOrigin:"anonymous"}).then(e=>{if(console.log("Background image loaded successfully"),e&&e.width&&e.height){let a=eS.width/e.width,l=eS.height/e.height;e.set({originX:"left",originY:"top",scaleX:a,scaleY:l}),t.backgroundImage=e,t.renderAll(),console.log("Background image set successfully"),eD(t),eB(t)}else console.error("Background image loaded but invalid dimensions"),eD(t),eB(t)}).catch(e=>{console.error("Failed to load background image:",e),eD(t),eB(t)})}return t.on("selection:created",e=>{u(e.selected?.[0]||null)}),t.on("selection:updated",e=>{u(e.selected?.[0]||null)}),t.on("selection:cleared",()=>{u(null)}),t.on("object:modified",()=>{eB(t)}),v(!0),()=>{t.dispose()}},[]),(0,a.useEffect)(()=>{e.id&&"new"!==e.id&&f&&d.current&&(console.log("Canvas mounted, loading template:",e.id),ez(e.id))},[e.id,f]);let ez=async e=>{try{let t=(0,ey.getAuthToken)(),a=await ej.default.get(`/certificate-templates/${e}`,t);if(console.log("Template response:",a),a.success&&a.data?.data){let t=a.data.data;if(console.log("Template data:",t),F(e),H(t.name),eE(t.vars||[]),t.template_json&&d.current){let e="string"==typeof t.template_json?JSON.parse(t.template_json):t.template_json;console.log("Loading template JSON into canvas"),console.log("Template JSON has",e.objects?.length||0,"objects");let a=d.current;if(e.width&&e.height){a.setDimensions({width:e.width,height:e.height}),eL({width:e.width,height:e.height});let t=eN.find(t=>t.width===e.width&&t.height===e.height);eT(t||eS)}await a.loadFromJSON(e),a.renderAll(),console.log("Template loaded successfully, objects:",a.getObjects().length),eB(a)}o({title:"Template Loaded",description:"Certificate template loaded successfully"})}else console.error("Invalid response structure:",a),o({title:"Error",description:"Invalid template data received",variant:"destructive"})}catch(e){console.error("Failed to load template:",e),o({title:"Error",description:"Failed to load certificate template",variant:"destructive"})}},eD=e=>{let t=new ew.Textbox("{{student_name}}",{left:350,top:350,width:500,fontSize:48,fontFamily:"Arial",fill:"#000000",fontWeight:"bold",textAlign:"center"});e.add(t);let a=new ew.Textbox("{{dateofIssue}}",{left:100,top:750,width:300,fontSize:24,fontFamily:"Arial",fill:"#000000",textAlign:"left"});e.add(a),e.renderAll()},eB=e=>{let t=JSON.stringify(e.toJSON()),a=m.slice(0,g+1);a.push(t),x(a),p(a.length-1)},eU=()=>{if(g>0&&d.current){let e=g-1;p(e),d.current.loadFromJSON(m[e],()=>{d.current?.renderAll()})}},eF=()=>{if(g<m.length-1&&d.current){let e=g+1;p(e),d.current.loadFromJSON(m[e],()=>{d.current?.renderAll()})}},eO=async e=>{if(d.current){console.log("Uploading image file to certificate-res:",e.name),A(!0),R(0);try{let t=`certificate-res/${Date.now()}-${e.name.replace(/\s+/g,"-")}`,a=e.type||"application/octet-stream";if(e.size>0x3200000){let a=await fetch(`${ek}/r2/static-bucket/presign?key=${encodeURIComponent(t)}`),l=await a.json();if(!l.success)throw Error(l.error||"Failed to get presigned URL");await new Promise((t,a)=>{let s=new XMLHttpRequest;s.upload.onprogress=e=>{if(e.lengthComputable){let t=Math.round(e.loaded/e.total*100);R(t)}},s.onload=()=>{s.status>=200&&s.status<300?t():a(Error(`Upload failed with status ${s.status}`))},s.onerror=()=>a(Error("Upload failed")),s.open("PUT",l.url),s.send(e)})}else await new Promise((l,s)=>{let i=new XMLHttpRequest;i.upload.onprogress=e=>{if(e.lengthComputable){let t=Math.round(e.loaded/e.total*100);R(t)}},i.onload=()=>{i.status>=200&&i.status<300?l():s(Error(`Upload failed with status ${i.status}`))},i.onerror=()=>s(Error("Upload failed")),i.open("POST",`${ek}/static/objects?path=${encodeURIComponent(t)}&contentType=${encodeURIComponent(a)}`),i.send(e)});let l=`https://cdn.digitalmadrasa.co.in/${t}`;console.log("Image uploaded successfully:",l),eH(l),w(!1),o({title:"Image uploaded",description:"Image has been added to the certificate"})}catch(e){console.error("Error uploading image:",e),o({title:"Upload failed",description:e instanceof Error?e.message:"Failed to upload image",variant:"destructive"})}finally{A(!1),R(0)}}},eH=e=>{d.current&&(console.log("Loading image into canvas:",e),ew.FabricImage.fromURL(e,{crossOrigin:"anonymous"}).then(e=>{if(!e||!e.width||!e.height){console.error("Failed to load image - invalid dimensions"),o({title:"Error",description:"Failed to load image. Please check the URL or try a different image.",variant:"destructive"});return}console.log("Image loaded successfully, dimensions:",e.width,"x",e.height);let t=Math.min(400/e.width,400/e.height,1);e.scale(t),e.set({left:100,top:100}),d.current?.add(e),d.current?.setActiveObject(e),d.current?.renderAll(),eB(d.current),o({title:"Image added",description:"Image added to certificate"})}).catch(e=>{console.error("Failed to load image:",e),o({title:"Error",description:"Failed to load image. Please check the URL or try a different image.",variant:"destructive"})}))},eV=()=>{if(!d.current)return[];let e=new Set;return d.current.getObjects().forEach(t=>{if("textbox"===t.type&&t.text){let a=t.text.match(/\{\{([^}]+)\}\}/g);a&&a.forEach(t=>{e.add(t)})}}),Array.from(e)},e$=e=>{let t=eN.find(t=>t.value===e);if(!t||!d.current)return;let a=d.current,l=eM.width,s=eM.height,i=t.width/l,r=t.height/s;if(a.setWidth(t.width),a.setHeight(t.height),a.getObjects().forEach(e=>{e.set({left:(e.left||0)*i,top:(e.top||0)*r,scaleX:(e.scaleX||1)*i,scaleY:(e.scaleY||1)*r}),e.setCoords()}),a.backgroundImage){let e=a.backgroundImage;e.set({scaleX:t.width/(e.width||t.width),scaleY:t.height/(e.height||t.height)})}a.renderAll(),eT(t),eL({width:t.width,height:t.height}),(()=>{if(!d.current)return;let e=JSON.stringify(d.current.toJSON()),t=m.slice(0,g+1);t.push(e),x(t),p(t.length-1)})()},e_=async()=>{if(!d.current||!U)return void o({title:"Cannot Save",description:"Template must be published first",variant:"destructive"});$(!0);try{let e=(0,ey.getAuthToken)(),t=d.current.toJSON(),a=eV(),l=await ej.default.put(`/certificate-templates/${U}`,{name:O,vars:a,template_json:{...t,width:eM.width,height:eM.height}},e);l.success?o({title:"Template Saved",description:"Your certificate template has been updated"}):o({title:"Error",description:l.message||"Failed to save template",variant:"destructive"})}catch(e){console.error("Error saving template:",e),o({title:"Error",description:"Failed to save template",variant:"destructive"})}finally{$(!1)}},eY=async()=>{if(!d.current)return void o({title:"Cannot Publish",description:"Please design your certificate first",variant:"destructive"});eP(!0);try{let e=(0,ey.getAuthToken)(),t=d.current.toJSON(),a=eV(),l=d.current.backgroundImage,s=l?.getSrc?.()||l?.src||null,i=await ej.default.post("/certificate-templates",{name:O,vars:a,template_json:{...t,width:eM.width,height:eM.height},template_thumbnail:s},e);i.success&&i.data?(F(i.data.id),o({title:"Template Published",description:"Your certificate template is now available"}),n.push("/admin/certificates")):o({title:"Error",description:i.message||"Failed to publish template",variant:"destructive"})}catch(e){console.error("Error publishing template:",e),o({title:"Error",description:"Failed to publish template",variant:"destructive"})}finally{eP(!1)}},eX=()=>{if(!d.current)return;d.current.discardActiveObject(),d.current.renderAll();let e=d.current.toDataURL({format:"png",quality:1,multiplier:2}),t=document.createElement("a");t.download=`certificate-${Date.now()}.png`,t.href=e,t.click(),o({title:"Certificate downloaded",description:"Your certificate has been saved"})},eJ=(e,t)=>{h&&d.current&&("fontFamily"===e&&(e=>{if(E.has(e)||eC.find(t=>t.value===e)?.isSystem)return;let t=document.createElement("link");t.href=`https://fonts.googleapis.com/css2?family=${e.replace(/ /g,"+")}:wght@400;700&display=swap`,t.rel="stylesheet",document.head.appendChild(t),z(t=>new Set(t).add(e))})(t),h.set(e,t),d.current.renderAll(),eB(d.current))},eG=e=>{h&&"textbox"===h.type&&d.current?(eJ("text",(h.text||"")+" "+e),I(!1),o({title:"Variable inserted",description:`${e} has been added to the text`})):o({title:"No text selected",description:"Please select a text element first",variant:"destructive"})},eK=(e,t="")=>h&&"textbox"===h.type&&h[e]||t;return(0,a.useEffect)(()=>{if(!d.current)return;let e=d.current,t=e=>{let t=e.selected?.[0];u(t||null),t&&B(!0===t.lockMovementX&&!0===t.lockMovementY)},a=e=>{let t=e.selected?.[0];u(t||null),t&&B(!0===t.lockMovementX&&!0===t.lockMovementY)},l=()=>{u(null),B(!1)};return e.on("selection:created",t),e.on("selection:updated",a),e.on("selection:cleared",l),()=>{e.off("selection:created",t),e.off("selection:updated",a),e.off("selection:cleared",l)}},[]),(0,t.jsxs)("div",{className:"h-screen flex flex-col bg-gray-100 overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-gradient-to-r from-[#0066ff] to-[#0052cc] text-white px-4 md:px-6 py-3 md:py-4 sticky top-0 z-50 shadow-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 md:gap-4",children:[(0,t.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:()=>n.push("/admin/certificates"),className:"gap-2 text-white hover:bg-white/20",children:[(0,t.jsx)(W.ArrowLeft,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Back"})]}),(0,t.jsx)(Y.Separator,{orientation:"vertical",className:"h-6 bg-white/30 hidden md:block"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-base md:text-lg font-heading font-bold",children:O}),(0,t.jsx)("p",{className:"text-xs text-white/80",children:"Certificate Editor"})]})]}),(0,t.jsxs)("div",{className:"hidden md:flex items-center gap-2",children:[(0,t.jsxs)(X.Select,{value:eR.value,onValueChange:e$,children:[(0,t.jsxs)(X.SelectTrigger,{className:"w-[140px] h-8 bg-white/10 border-white/30 text-white text-sm",children:[(0,t.jsx)(eb,{className:"w-4 h-4 mr-2"}),(0,t.jsx)(X.SelectValue,{placeholder:"Ratio"})]}),(0,t.jsx)(X.SelectContent,{children:eN.map(e=>(0,t.jsxs)(X.SelectItem,{value:e.value,children:[e.label," (",e.width,"x",e.height,")"]},e.value))})]}),(0,t.jsx)(Y.Separator,{orientation:"vertical",className:"h-6 bg-white/30"}),(0,t.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:eU,disabled:g<=0,className:"gap-1 text-white hover:bg-white/20",children:[(0,t.jsx)(ee,{className:"w-4 h-4"}),"Undo"]}),(0,t.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:eF,disabled:g>=m.length-1,className:"gap-1 text-white hover:bg-white/20",children:[(0,t.jsx)(et,{className:"w-4 h-4"}),"Redo"]}),(0,t.jsx)(Y.Separator,{orientation:"vertical",className:"h-6 bg-white/30"}),U?(0,t.jsxs)(l.Button,{onClick:e_,size:"sm",variant:"ghost",className:"gap-2 text-white hover:bg-white/20",disabled:V,children:[V?(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):(0,t.jsx)(ex.Save,{className:"w-4 h-4"}),V?"Saving...":"Save"]}):(0,t.jsxs)(l.Button,{onClick:eY,size:"sm",className:"gap-2 bg-white text-[#0066ff] hover:bg-gray-100",disabled:Z,children:[Z?(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#0066ff]"}):(0,t.jsx)(ex.Save,{className:"w-4 h-4"}),Z?"Publishing...":"Publish"]}),(0,t.jsxs)(l.Button,{onClick:eX,size:"sm",className:"gap-2 bg-white text-[#0066ff] hover:bg-gray-100",children:[(0,t.jsx)(Q.Download,{className:"w-4 h-4"}),"Download"]})]}),(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:()=>M(!T),className:"md:hidden text-white hover:bg-white/20",children:(0,t.jsx)(em.Menu,{className:"w-5 h-5"})})]}),T&&(0,t.jsx)("div",{className:"md:hidden absolute top-full left-0 right-0 bg-[#0052cc] border-t border-white/20 p-4 shadow-lg",children:(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(i.Label,{className:"text-white text-sm",children:"Aspect Ratio:"}),(0,t.jsxs)(X.Select,{value:eR.value,onValueChange:e$,children:[(0,t.jsx)(X.SelectTrigger,{className:"flex-1 h-8 bg-white/10 border-white/30 text-white text-sm",children:(0,t.jsx)(X.SelectValue,{placeholder:"Ratio"})}),(0,t.jsx)(X.SelectContent,{children:eN.map(e=>(0,t.jsx)(X.SelectItem,{value:e.value,children:e.label},e.value))})]})]}),(0,t.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:eU,disabled:g<=0,className:"gap-1 text-white hover:bg-white/20 flex-1",children:[(0,t.jsx)(ee,{className:"w-4 h-4"}),"Undo"]}),(0,t.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:eF,disabled:g>=m.length-1,className:"gap-1 text-white hover:bg-white/20 flex-1",children:[(0,t.jsx)(et,{className:"w-4 h-4"}),"Redo"]}),U?(0,t.jsxs)(l.Button,{onClick:e_,size:"sm",className:"gap-2 bg-white/20 text-white hover:bg-white/30 w-full",disabled:V,children:[V?(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):(0,t.jsx)(ex.Save,{className:"w-4 h-4"}),V?"Saving...":"Save Template"]}):(0,t.jsxs)(l.Button,{onClick:eY,size:"sm",className:"gap-2 bg-white text-[#0066ff] hover:bg-gray-100 w-full",disabled:Z,children:[Z?(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#0066ff]"}):(0,t.jsx)(ex.Save,{className:"w-4 h-4"}),Z?"Publishing...":"Publish Template"]}),(0,t.jsxs)(l.Button,{onClick:eX,size:"sm",className:"gap-2 bg-white text-[#0066ff] hover:bg-gray-100 w-full",children:[(0,t.jsx)(Q.Download,{className:"w-4 h-4"}),"Download PNG"]})]})})]}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col lg:flex-row overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex-1 flex items-center justify-center p-2 md:p-4 overflow-auto bg-gradient-to-br from-gray-50 to-gray-100",children:[(0,t.jsx)("div",{className:"bg-white shadow-2xl rounded-lg overflow-hidden",style:{width:eM.width,height:eM.height,maxWidth:"100%"},children:(0,t.jsx)("canvas",{ref:c})}),(0,t.jsxs)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-white rounded-2xl shadow-2xl border border-gray-200 p-2 flex items-center gap-2 z-10",children:[(0,t.jsxs)(l.Button,{onClick:()=>{if(!d.current)return;let e=new ew.Textbox("New Text",{left:100,top:100,width:300,fontSize:24,fontFamily:"Arial",fill:"#000000"});d.current.add(e),d.current.setActiveObject(e),d.current.renderAll(),eB(d.current),o({title:"Text added",description:"Double-click to edit the text, or use properties panel"})},variant:"outline",size:"sm",className:"gap-2 bg-transparent",children:[(0,t.jsx)(ea,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Add Text"})]}),(0,t.jsxs)(l.Button,{onClick:()=>w(!0),variant:"outline",size:"sm",className:"gap-2",children:[(0,t.jsx)(el.ImageIcon,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Add Image"})]}),(0,t.jsxs)(l.Button,{onClick:()=>I(!0),variant:"outline",size:"sm",className:"gap-2",children:[(0,t.jsx)(ef,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Insert Variable"})]})]})]}),h&&(0,t.jsxs)("div",{className:"w-full lg:w-80 bg-white border-t lg:border-l lg:border-t-0 border-gray-200 p-4 md:p-6 overflow-auto max-h-[400px] lg:max-h-none",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[(0,t.jsxs)("h2",{className:"text-base md:text-lg font-heading font-semibold",children:["textbox"===h.type&&"Text Properties","image"===h.type&&"Image Properties"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>{if(!h||!d.current)return;let e=!D;h.set({lockMovementX:e,lockMovementY:e,lockScalingX:e,lockScalingY:e,lockRotation:e,hasControls:!e,selectable:!0}),B(e),d.current.renderAll(),eB(d.current),o({title:e?"Element locked":"Element unlocked",description:e?"Position and size are now locked":"You can now move and resize this element"})},className:`gap-2 ${D?"bg-amber-50 border-amber-300 text-amber-700 hover:bg-amber-100":"hover:bg-gray-50"}`,title:D?"Unlock element":"Lock element",children:[D?(0,t.jsx)(eg.Lock,{className:"w-4 h-4"}):(0,t.jsx)(ep,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:D?"Locked":"Unlocked"})]}),(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:()=>{d.current&&h&&(d.current.remove(h),d.current.renderAll(),eB(d.current),u(null))},className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,t.jsx)(es.Trash2,{className:"w-4 h-4"})})]})]}),D&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:(0,t.jsxs)("p",{className:"text-xs text-amber-800 flex items-center gap-2",children:[(0,t.jsx)(eg.Lock,{className:"w-3 h-3"}),"This element is locked. Position and size cannot be changed on canvas."]})}),(0,t.jsxs)("div",{className:"space-y-4 md:space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-3 md:space-y-4",children:[(0,t.jsx)(i.Label,{className:"text-sm font-semibold text-gray-700",children:"Position"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 md:gap-3",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{className:"text-xs text-gray-600",children:"X Position"}),(0,t.jsx)(s.Input,{type:"number",value:Math.round(h.left||0),onChange:e=>eJ("left",Number.parseFloat(e.target.value)),className:"h-9"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{className:"text-xs text-gray-600",children:"Y Position"}),(0,t.jsx)(s.Input,{type:"number",value:Math.round(h.top||0),onChange:e=>eJ("top",Number.parseFloat(e.target.value)),className:"h-9"})]})]})]}),"textbox"===h.type&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Y.Separator,{}),(0,t.jsxs)("div",{className:"space-y-3 md:space-y-4",children:[(0,t.jsx)(i.Label,{className:"text-sm font-semibold text-gray-700",children:"Text Content"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{className:"text-xs text-gray-600",children:"Text (or double-click on canvas)"}),(0,t.jsx)(s.Input,{value:eK("text"),onChange:e=>eJ("text",e.target.value),className:"h-9",placeholder:"Use {{variable_name}} for placeholders"}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["Tip: Use variables like ","{{student_name}}"," for dynamic content"]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(i.Label,{className:"text-xs text-gray-600",children:["Font Size: ",eK("fontSize",20),"px"]}),(0,t.jsx)(_,{value:[eK("fontSize",20)],onValueChange:([e])=>eJ("fontSize",e),min:8,max:120,step:1,className:"w-full"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{className:"text-xs text-gray-600",children:"Font Family"}),(0,t.jsxs)(X.Select,{value:eK("fontFamily","Arial"),onValueChange:e=>eJ("fontFamily",e),children:[(0,t.jsx)(X.SelectTrigger,{className:"h-9",children:(0,t.jsx)(X.SelectValue,{})}),(0,t.jsx)(X.SelectContent,{className:"max-h-[300px]",children:eC.map(e=>(0,t.jsx)(X.SelectItem,{value:e.value,children:(0,t.jsx)("span",{style:{fontFamily:e.value},children:e.name})},e.value))})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Includes Google Fonts and system fonts"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{className:"text-xs text-gray-600",children:"Text Style"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>{h&&"textbox"===h.type&&eJ("fontWeight","bold"===h.fontWeight?"normal":"bold")},className:`flex-1 ${"bold"===eK("fontWeight")?"bg-[#0066ff] text-white":""}`,children:(0,t.jsx)(ei,{className:"w-4 h-4"})}),(0,t.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>{h&&"textbox"===h.type&&eJ("fontStyle","italic"===h.fontStyle?"normal":"italic")},className:`flex-1 ${"italic"===eK("fontStyle")?"bg-[#0066ff] text-white":""}`,children:(0,t.jsx)(er,{className:"w-4 h-4"})}),(0,t.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>{h&&"textbox"===h.type&&eJ("underline",!h.underline)},className:`flex-1 ${eK("underline")?"bg-[#0066ff] text-white":""}`,children:(0,t.jsx)(en,{className:"w-4 h-4"})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{className:"text-xs text-gray-600",children:"Text Alignment"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(l.Button,{variant:"outline",size:"sm",className:`flex-1 ${"left"===eK("textAlign")?"bg-[#0066ff] text-white":""}`,onClick:()=>eJ("textAlign","left"),children:(0,t.jsx)(eo,{className:"w-4 h-4"})}),(0,t.jsx)(l.Button,{variant:"outline",size:"sm",className:`flex-1 ${"center"===eK("textAlign")?"bg-[#0066ff] text-white":""}`,onClick:()=>eJ("textAlign","center"),children:(0,t.jsx)(ec,{className:"w-4 h-4"})}),(0,t.jsx)(l.Button,{variant:"outline",size:"sm",className:`flex-1 ${"right"===eK("textAlign")?"bg-[#0066ff] text-white":""}`,onClick:()=>eJ("textAlign","right"),children:(0,t.jsx)(ed,{className:"w-4 h-4"})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{className:"text-xs text-gray-600",children:"Text Color"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(s.Input,{type:"color",value:eK("fill","#000000"),onChange:e=>eJ("fill",e.target.value),className:"h-10 w-20"}),(0,t.jsx)(s.Input,{value:eK("fill","#000000"),onChange:e=>eJ("fill",e.target.value),className:"h-10 flex-1",placeholder:"#000000"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(i.Label,{className:"text-xs text-gray-600",children:["Letter Spacing: ",Math.round(eK("charSpacing",0))]}),(0,t.jsx)(_,{value:[eK("charSpacing",0)],onValueChange:([e])=>eJ("charSpacing",e),min:-50,max:200,step:10,className:"w-full"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(i.Label,{className:"text-xs text-gray-600",children:["Line Height: ",eK("lineHeight",1).toFixed(2)]}),(0,t.jsx)(_,{value:[eK("lineHeight",1)],onValueChange:([e])=>eJ("lineHeight",e),min:.5,max:3,step:.1,className:"w-full"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(i.Label,{className:"text-xs text-gray-600",children:["Text Width: ",Math.round(eK("width",200)),"px"]}),(0,t.jsx)(_,{value:[eK("width",200)],onValueChange:([e])=>eJ("width",e),min:50,max:1e3,step:10,className:"w-full"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(i.Label,{className:"text-xs text-gray-600",children:["Opacity: ",Math.round(100*eK("opacity",1)),"%"]}),(0,t.jsx)(_,{value:[100*eK("opacity",1)],onValueChange:([e])=>eJ("opacity",e/100),min:0,max:100,step:5,className:"w-full"})]})]})]}),"image"===h.type&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Y.Separator,{}),(0,t.jsxs)("div",{className:"space-y-3 md:space-y-4",children:[(0,t.jsx)(i.Label,{className:"text-sm font-semibold text-gray-700",children:"Image Scale"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(i.Label,{className:"text-xs text-gray-600",children:["Scale: ",Math.round(100*(h.scaleX||1)),"%"]}),(0,t.jsx)(_,{value:[100*(h.scaleX||1)],onValueChange:([e])=>{let t=e/100;eJ("scaleX",t),eJ("scaleY",t)},min:10,max:200,step:5,className:"w-full"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(i.Label,{className:"text-xs text-gray-600",children:["Opacity: ",Math.round(100*(h.opacity||1)),"%"]}),(0,t.jsx)(_,{value:[100*(h.opacity||1)],onValueChange:([e])=>eJ("opacity",e/100),min:0,max:100,step:5,className:"w-full"})]})]})]})]})]})]}),(0,t.jsx)(J.Dialog,{open:b,onOpenChange:w,children:(0,t.jsxs)(J.DialogContent,{className:"sm:max-w-md",children:[(0,t.jsx)(J.DialogHeader,{children:(0,t.jsx)(J.DialogTitle,{children:"Add Image"})}),(0,t.jsxs)(G.Tabs,{value:j,onValueChange:y,className:"w-full",children:[(0,t.jsxs)(G.TabsList,{className:"grid w-full grid-cols-2",children:[(0,t.jsxs)(G.TabsTrigger,{value:"upload",className:"gap-2",children:[(0,t.jsx)(eh.Upload,{className:"w-4 h-4"}),"Upload"]}),(0,t.jsxs)(G.TabsTrigger,{value:"url",className:"gap-2",children:[(0,t.jsx)(eu.LinkIcon,{className:"w-4 h-4"}),"URL"]})]}),(0,t.jsx)(G.TabsContent,{value:"upload",className:"space-y-4",children:(0,t.jsxs)("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${C?"border-blue-300 bg-blue-50":"border-gray-300 hover:border-[#0066ff] cursor-pointer"}`,onClick:()=>!C&&k.current?.click(),children:[C?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(ev.Loader2,{className:"w-10 h-10 mx-auto text-blue-500 animate-spin"}),(0,t.jsxs)("p",{className:"text-sm text-blue-600 font-medium",children:["Uploading... ",P,"%"]}),(0,t.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${P}%`}})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eh.Upload,{className:"w-10 h-10 mx-auto text-gray-400 mb-3"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Click to upload or drag and drop"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"PNG, JPG, SVG up to 50MB"})]}),(0,t.jsx)("input",{ref:k,type:"file",accept:"image/*",className:"hidden",disabled:C,onChange:e=>{let t=e.target.files?.[0];t&&eO(t)}})]})}),(0,t.jsxs)(G.TabsContent,{value:"url",className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{children:"Image URL"}),(0,t.jsx)(s.Input,{value:N,onChange:e=>S(e.target.value),placeholder:"https://example.com/image.jpg"})]}),(0,t.jsxs)(J.DialogFooter,{children:[(0,t.jsx)(l.Button,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),(0,t.jsx)(l.Button,{onClick:()=>{N&&d.current?(console.log("Adding image from URL:",N),eH(N),w(!1),S("")):o({title:"Error",description:"Please enter a valid image URL",variant:"destructive"})},className:"bg-[#0066ff] hover:bg-[#0052cc]",children:"Add Image"})]})]})]})]})}),(0,t.jsx)(J.Dialog,{open:L,onOpenChange:I,children:(0,t.jsxs)(J.DialogContent,{className:"sm:max-w-md",children:[(0,t.jsx)(J.DialogHeader,{children:(0,t.jsx)(J.DialogTitle,{children:"Insert Variable"})}),(0,t.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Select a variable to insert into your text. Variables will be replaced with actual data when certificates are generated."}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-2 max-h-[400px] overflow-auto",children:[eA.map(e=>(0,t.jsx)(l.Button,{variant:"outline",className:"justify-start text-left h-auto py-3 bg-transparent",onClick:()=>eG(e.value),children:(0,t.jsxs)("div",{className:"flex flex-col items-start",children:[(0,t.jsx)("span",{className:"font-medium",children:e.label}),(0,t.jsx)("span",{className:"text-xs text-gray-500 font-mono",children:e.value})]})},e.value)),eI.filter(e=>!eA.some(t=>t.value===e)).map(e=>(0,t.jsx)(l.Button,{variant:"outline",className:"justify-start text-left h-auto py-3 bg-transparent",onClick:()=>eG(e),children:(0,t.jsxs)("div",{className:"flex flex-col items-start",children:[(0,t.jsx)("span",{className:"font-medium",children:e.replace(/[{}]/g,"")}),(0,t.jsx)("span",{className:"text-xs text-gray-500 font-mono",children:e})]})},e))]}),(0,t.jsx)("div",{className:"pt-4 border-t",children:(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["You can also manually type variables in the format: ","{{variable_name}}"]})})]})]})})]})}e.s(["default",()=>eP],588580)}]);